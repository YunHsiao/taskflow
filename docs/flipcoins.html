<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Learning from Examples &raquo; Flip Coins | Taskflow QuickStart</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <span id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">
        <a href="https://taskflow.github.io"><img src="taskflow_logo.png" alt="" />Taskflow</a> <span class="m-breadcrumb">|</span> <a href="index.html" class="m-thin">QuickStart</a>
      </span>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Handbook</a></li>
            <li><a href="namespaces.html">Namespaces</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="Examples.html">Learning from Examples</a> &raquo;</span>
          Flip Coins
        </h1>
        <div class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li><a href="#FlipCoinsProblemFormulation">Problem Formulation</a></li>
            <li><a href="#FlipCoinsProbabilistic">Probabilistic Conditions</a></li>
            <li><a href="#FlipCoinsTernaryCoins">Ternary Coins</a></li>
          </ul>
        </div>
<p>We study dynamic control flow of non-determinism using conditional tasking. Non-deterministic control flow is a fundamental building block in many optimization and simulation algorithms that rely on stochastic convergence rules or probabilistic pruning.</p><section id="FlipCoinsProblemFormulation"><h2><a href="#FlipCoinsProblemFormulation">Problem Formulation</a></h2><p>We have a fair binary coin and want to simulate its tosses. We flip the coin for five times. Apparently, the probability for the result to be all heads is 1/32. It is equivalently to say the expected number we need to toss for obtaining five heads is 32.</p><div class="m-graph"><svg style="width: 47.875rem; height: 2.750rem;" viewBox="0.00 0.00 766.25 44.00">
<g transform="scale(1 1) rotate(0) translate(4 40)">
<title>G</title>
<g class="m-node m-flat">
<title>a</title>
<ellipse cx="43.5352" cy="-18" rx="43.5704" ry="18"/>
<text text-anchor="middle" x="43.5352" y="-13.2">1/2 (H)</text>
</g>
<g class="m-node m-flat">
<title>b</title>
<ellipse cx="174.3567" cy="-18" rx="51.0735" ry="18"/>
<text text-anchor="middle" x="174.3567" y="-13.2">1/4 (HH)</text>
</g>
<g class="m-edge">
<title>a&#45;&gt;b</title>
<path d="M87.0969,-18C95.3241,-18 104.0723,-18 112.7317,-18"/>
<polygon points="112.8199,-21.5001 122.8198,-18 112.8198,-14.5001 112.8199,-21.5001"/>
</g>
<g class="m-node m-flat">
<title>c</title>
<ellipse cx="320.6805" cy="-18" rx="59.0749" ry="18"/>
<text text-anchor="middle" x="320.6805" y="-13.2">1/8 (HHH)</text>
</g>
<g class="m-edge">
<title>b&#45;&gt;c</title>
<path d="M225.945,-18C234.2244,-18 242.9087,-18 251.5189,-18"/>
<polygon points="251.5637,-21.5001 261.5637,-18 251.5637,-14.5001 251.5637,-21.5001"/>
</g>
<g class="m-node m-flat">
<title>d</title>
<ellipse cx="488.4757" cy="-18" rx="72.5164" ry="18"/>
<text text-anchor="middle" x="488.4757" y="-13.2">1/16 (HHHH)</text>
</g>
<g class="m-edge">
<title>c&#45;&gt;d</title>
<path d="M379.8388,-18C388.1125,-18 396.7386,-18 405.3539,-18"/>
<polygon points="405.4408,-21.5001 415.4407,-18 405.4407,-14.5001 405.4408,-21.5001"/>
</g>
<g class="m-node m-flat">
<title>e</title>
<ellipse cx="677.7424" cy="-18" rx="80.5179" ry="18"/>
<text text-anchor="middle" x="677.7424" y="-13.2">1/32 (HHHHH)</text>
</g>
<g class="m-edge">
<title>d&#45;&gt;e</title>
<path d="M561.3804,-18C569.7633,-18 578.3867,-18 586.9676,-18"/>
<polygon points="587.0046,-21.5001 597.0045,-18 587.0045,-14.5001 587.0046,-21.5001"/>
</g>
</g>
</svg>
</div></section><section id="FlipCoinsProbabilistic"><h2><a href="#FlipCoinsProbabilistic">Probabilistic Conditions</a></h2><p>We use condition tasks to simulate the five coin tosses. We create five condition tasks each returning a random binary number. If the return is zero (head toss), the execution moves to the next condition task; or it (tail toss) goes back to the first condition task to start over the simulation.</p><pre class="m-code"><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span> <span class="n">taskflow</span><span class="p">;</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Executor</span> <span class="n">executor</span><span class="p">;</span>

<span class="kt">size_t</span> <span class="n">rounds</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="kt">size_t</span> <span class="n">tosses</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
<span class="kt">size_t</span> <span class="n">total_tosses</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
<span class="kt">double</span> <span class="n">average_tosses</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> 

<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">A</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="n">tosses</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;init&quot;</span><span class="p">);</span> 

<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">B</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="o">++</span><span class="n">tosses</span><span class="p">;</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;flip-coin-1&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">C</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;flip-coin-2&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">D</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;flip-coin-3&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">E</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;flip-coin-4&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">F</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;flip-coin-5&quot;</span><span class="p">);</span>

<span class="c1">// reach the target; record the number of tosses </span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">G</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="n">total_tosses</span> <span class="o">+=</span> <span class="n">tosses</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;stop&quot;</span><span class="p">);</span>

<span class="n">A</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">B</span><span class="p">);</span>

<span class="c1">// five probabilistic conditions</span>
<span class="n">B</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
<span class="n">C</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
<span class="n">D</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
<span class="n">E</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
<span class="n">F</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>

<span class="c1">// repeat the flip-coin simulation by rounds times</span>
<span class="n">executor</span><span class="p">.</span><span class="n">run_n</span><span class="p">(</span><span class="n">taskflow</span><span class="p">,</span> <span class="n">rounds</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span>

<span class="c1">// calculate the expected number of tosses</span>
<span class="n">average_tosses</span> <span class="o">=</span> <span class="n">total_tosses</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">rounds</span><span class="p">;</span>

<span class="n">assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">fabs</span><span class="p">(</span><span class="n">average_tosses</span><span class="mf">-32.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="p">);</span></pre><p>Running the taskflow by a fair number of times, the average tosses we have is close to 32. The taskflow diagram is depicted below.</p><div class="m-graph"><svg style="width: 74.688rem; height: 10.625rem;" viewBox="0.00 0.00 1195.32 170.00">
<g transform="scale(1 1) rotate(0) translate(4 166)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7fa9a4803e30</title>
<ellipse cx="27" cy="-92" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-87.2">init</text>
</g>
<g class="m-node">
<title>p0x7fa9a4803f50</title>
<polygon points="171.979,-110 91.021,-92 171.979,-74 252.937,-92 171.979,-110"/>
<text text-anchor="middle" x="171.979" y="-87.2">flip&#45;coin&#45;1</text>
</g>
<g class="m-edge">
<title>p0x7fa9a4803e30&#45;&gt;p0x7fa9a4803f50</title>
<path d="M54.2694,-92C62.1836,-92 71.295,-92 80.8715,-92"/>
<polygon points="80.9889,-95.5001 90.9888,-92 80.9888,-88.5001 80.9889,-95.5001"/>
</g>
<g class="m-edge">
<title>p0x7fa9a4803f50&#45;&gt;p0x7fa9a4803f50</title>
<path stroke-dasharray="5,2" d="M155.7753,-106.4167C150.1168,-117.166 155.5181,-128 171.979,-128 183.0387,-128 189.1059,-123.1094 190.1805,-116.6397"/>
<polygon points="193.5358,-115.5597 188.1827,-106.4167 186.6657,-116.9023 193.5358,-115.5597"/>
<text text-anchor="middle" x="171.979" y="-131.2">1</text>
</g>
<g class="m-node">
<title>p0x7fa9a4804070</title>
<polygon points="378.8355,-162 297.8774,-144 378.8355,-126 459.7935,-144 378.8355,-162"/>
<text text-anchor="middle" x="378.8355" y="-139.2">flip&#45;coin&#45;2</text>
</g>
<g class="m-edge">
<title>p0x7fa9a4803f50&#45;&gt;p0x7fa9a4804070</title>
<path stroke-dasharray="5,2" d="M192.1452,-105.6177C211.4303,-117.784 241.8085,-134.7692 270.958,-142 281.3283,-144.5724 292.4328,-146.0978 303.4295,-146.9151"/>
<polygon points="303.2945,-150.4129 313.4742,-147.4762 303.685,-143.4238 303.2945,-150.4129"/>
<text text-anchor="middle" x="275.4072" y="-146.2">0</text>
</g>
<g class="m-edge">
<title>p0x7fa9a4804070&#45;&gt;p0x7fa9a4803f50</title>
<path stroke-dasharray="5,2" d="M340.6179,-134.3928C306.7199,-125.8714 257.0384,-113.3824 220.3743,-104.1657"/>
<polygon points="220.9539,-100.7026 210.4023,-101.6589 219.2473,-107.4914 220.9539,-100.7026"/>
<text text-anchor="middle" x="275.4072" y="-121.2">1</text>
</g>
<g class="m-node">
<title>p0x7fa9a4804190</title>
<polygon points="585.6919,-110 504.7339,-92 585.6919,-74 666.65,-92 585.6919,-110"/>
<text text-anchor="middle" x="585.6919" y="-87.2">flip&#45;coin&#45;3</text>
</g>
<g class="m-edge">
<title>p0x7fa9a4804070&#45;&gt;p0x7fa9a4804190</title>
<path stroke-dasharray="5,2" d="M417.2588,-134.3411C451.2205,-125.8037 500.9075,-113.3133 537.5188,-104.1099"/>
<polygon points="538.6294,-107.4396 547.4744,-101.6072 536.9228,-100.6509 538.6294,-107.4396"/>
<text text-anchor="middle" x="482.2637" y="-121.2">0</text>
</g>
<g class="m-edge">
<title>p0x7fa9a4804190&#45;&gt;p0x7fa9a4803f50</title>
<path stroke-dasharray="5,2" d="M504.635,-92C435.3836,-92 335.8039,-92 263.66,-92"/>
<polygon points="263.2218,-88.5001 253.2218,-92 263.2217,-95.5001 263.2218,-88.5001"/>
<text text-anchor="middle" x="378.8355" y="-95.2">1</text>
</g>
<g class="m-node">
<title>p0x7fa9a48042b0</title>
<polygon points="792.5484,-66 711.5904,-48 792.5484,-30 873.5064,-48 792.5484,-66"/>
<text text-anchor="middle" x="792.5484" y="-43.2">flip&#45;coin&#45;4</text>
</g>
<g class="m-edge">
<title>p0x7fa9a4804190&#45;&gt;p0x7fa9a48042b0</title>
<path stroke-dasharray="5,2" d="M627.5524,-83.0959C660.3242,-76.1251 706.062,-66.3963 741.0722,-58.9494"/>
<polygon points="742.0507,-62.3196 751.1036,-56.8156 740.5943,-55.4728 742.0507,-62.3196"/>
<text text-anchor="middle" x="689.1202" y="-73.2">0</text>
</g>
<g class="m-edge">
<title>p0x7fa9a48042b0&#45;&gt;p0x7fa9a4803f50</title>
<path stroke-dasharray="5,2" d="M727.0756,-51.4562C668.7183,-54.6347 580.9902,-59.6533 504.7129,-65 413.1523,-71.418 307.5369,-80.2283 240.2972,-86.0148"/>
<polygon points="239.9146,-82.5347 230.2525,-86.8813 240.5163,-89.5088 239.9146,-82.5347"/>
<text text-anchor="middle" x="482.2637" y="-69.2">1</text>
</g>
<g class="m-node">
<title>p0x7fa9a48043d0</title>
<polygon points="999.4049,-36 918.4468,-18 999.4049,0 1080.3629,-18 999.4049,-36"/>
<text text-anchor="middle" x="999.4049" y="-13.2">flip&#45;coin&#45;5</text>
</g>
<g class="m-edge">
<title>p0x7fa9a48042b0&#45;&gt;p0x7fa9a48043d0</title>
<path stroke-dasharray="5,2" d="M841.5705,-40.8904C871.2171,-36.5908 909.201,-31.0821 940.4769,-26.5462"/>
<polygon points="940.9825,-30.0096 950.3766,-25.1105 939.9778,-23.0821 940.9825,-30.0096"/>
<text text-anchor="middle" x="895.9766" y="-36.2">0</text>
</g>
<g class="m-edge">
<title>p0x7fa9a48043d0&#45;&gt;p0x7fa9a4803f50</title>
<path stroke-dasharray="5,2" d="M946.7784,-11.6764C905.0234,-7.2041 845.1374,-2 792.5484,-2 378.8355,-2 378.8355,-2 378.8355,-2 309.2207,-2 236.552,-45.3892 198.6317,-71.9143"/>
<polygon points="196.3032,-69.2763 190.2011,-77.9375 200.3725,-74.972 196.3032,-69.2763"/>
<text text-anchor="middle" x="585.6919" y="-5.2">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fa9a48044f0</title>
<ellipse cx="1156.3025" cy="-18" rx="31.0404" ry="18"/>
<text text-anchor="middle" x="1156.3025" y="-13.2">stop</text>
</g>
<g class="m-edge">
<title>p0x7fa9a48043d0&#45;&gt;p0x7fa9a48044f0</title>
<path stroke-dasharray="5,2" d="M1080.6112,-18C1092.5002,-18 1104.3046,-18 1114.9304,-18"/>
<polygon points="1115.1229,-21.5001 1125.1229,-18 1115.1228,-14.5001 1115.1229,-21.5001"/>
<text text-anchor="middle" x="1102.8331" y="-21.2">0</text>
</g>
</g>
</svg>
</div><p>Although the execution of this taskflow is non-deterministic, its control flow can expand to a tree of tasks based on our scheduling rule for conditional tasking (see <a href="chapter4.html" class="m-doc">Conditional Tasking</a>). Each path from the root to a leaf represents a result of five heads, and none of them can overlap at the same time (no task race). You must follow the same rule when creating a probabilistic framework using conditional tasking.</p></section><section id="FlipCoinsTernaryCoins"><h2><a href="#FlipCoinsTernaryCoins">Ternary Coins</a></h2><p>We can extend the binary coin example to a ternary case. Each condition task has one successor going back to the beginning and two successors moving to the next task. The expected number of tosses to reach five identical results is 3*3*3*3*3 = 243.</p><pre class="m-code"><span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">A</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](){</span> <span class="n">tosses</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="p">)</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;init&quot;</span><span class="p">);</span> 

<span class="c1">// start over the flip again</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">B</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="o">++</span><span class="n">tosses</span><span class="p">;</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">3</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;flip-coin-1&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">C</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">3</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;flip-coin-2&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">D</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">3</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;flip-coin-3&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">E</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">3</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;flip-coin-4&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">F</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">3</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;flip-coin-5&quot;</span><span class="p">);</span>

<span class="c1">// reach the target; record the number of tosses </span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">G</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span> <span class="n">total_tosses</span> <span class="o">+=</span> <span class="n">tosses</span><span class="p">;</span> <span class="p">})</span>
                     <span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;stop&quot;</span><span class="p">);</span>

<span class="n">A</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">B</span><span class="p">);</span>

<span class="c1">// five probabilistic conditions</span>
<span class="n">B</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
<span class="n">C</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
<span class="n">D</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
<span class="n">E</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
<span class="n">F</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>

<span class="c1">// repeat the flip-coin simulation by rounds times</span>
<span class="n">executor</span><span class="p">.</span><span class="n">run_n</span><span class="p">(</span><span class="n">taskflow</span><span class="p">,</span> <span class="n">rounds</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span>

<span class="c1">// calculate the expected number of tosses</span>
<span class="n">average_tosses</span> <span class="o">=</span> <span class="n">total_tosses</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">rounds</span><span class="p">;</span>

<span class="n">assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">fabs</span><span class="p">(</span><span class="n">average_tosses</span><span class="mf">-243.0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="p">);</span></pre><div class="m-graph"><svg style="width: 74.688rem; height: 20.438rem;" viewBox="0.00 0.00 1195.32 327.00">
<g transform="scale(1 1) rotate(0) translate(4 323)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7fca00803e30</title>
<ellipse cx="27" cy="-179" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-174.2">init</text>
</g>
<g class="m-node">
<title>p0x7fca00803f50</title>
<polygon points="171.979,-197 91.021,-179 171.979,-161 252.937,-179 171.979,-197"/>
<text text-anchor="middle" x="171.979" y="-174.2">flip&#45;coin&#45;1</text>
</g>
<g class="m-edge">
<title>p0x7fca00803e30&#45;&gt;p0x7fca00803f50</title>
<path d="M54.2694,-179C62.1836,-179 71.295,-179 80.8715,-179"/>
<polygon points="80.9889,-182.5001 90.9888,-179 80.9888,-175.5001 80.9889,-182.5001"/>
</g>
<g class="m-edge">
<title>p0x7fca00803f50&#45;&gt;p0x7fca00803f50</title>
<path stroke-dasharray="5,2" d="M163.4398,-195.2903C161.3806,-205.3892 164.2271,-215 171.979,-215 176.9451,-215 179.898,-211.0557 180.8376,-205.5656"/>
<polygon points="184.3273,-205.1767 180.5183,-195.2903 177.3307,-205.3942 184.3273,-205.1767"/>
<text text-anchor="middle" x="171.979" y="-218.2">1</text>
</g>
<g class="m-edge">
<title>p0x7fca00803f50&#45;&gt;p0x7fca00803f50</title>
<path stroke-dasharray="5,2" d="M158.6385,-194.2026C148.8701,-212.1122 153.3169,-233 171.979,-233 187.4336,-233 193.1394,-218.6754 189.0966,-203.58"/>
<polygon points="192.3023,-202.1708 185.3195,-194.2026 185.8092,-204.7861 192.3023,-202.1708"/>
<text text-anchor="middle" x="171.979" y="-236.2">2</text>
</g>
<g class="m-node">
<title>p0x7fca00804070</title>
<polygon points="378.8355,-301 297.8774,-283 378.8355,-265 459.7935,-283 378.8355,-301"/>
<text text-anchor="middle" x="378.8355" y="-278.2">flip&#45;coin&#45;2</text>
</g>
<g class="m-edge">
<title>p0x7fca00803f50&#45;&gt;p0x7fca00804070</title>
<path stroke-dasharray="5,2" d="M179.4604,-195.4512C193.0837,-223.135 224.8511,-278.148 270.958,-300 293.5415,-310.7033 321.4687,-305.8775 343.2495,-298.6767"/>
<polygon points="344.5575,-301.9259 352.7832,-295.2484 342.1887,-295.3388 344.5575,-301.9259"/>
<text text-anchor="middle" x="275.4072" y="-306.2">0</text>
</g>
<g class="m-edge">
<title>p0x7fca00804070&#45;&gt;p0x7fca00803f50</title>
<path stroke-dasharray="5,2" d="M323.9336,-277.1446C306.4146,-273.8925 287.3362,-268.8413 270.958,-261 240.4907,-246.4133 211.447,-220.4062 192.796,-201.5847"/>
<polygon points="194.9355,-198.7627 185.4652,-194.0126 189.9063,-203.6317 194.9355,-198.7627"/>
<text text-anchor="middle" x="275.4072" y="-267.2">1</text>
</g>
<g class="m-edge">
<title>p0x7fca00804070&#45;&gt;p0x7fca00803f50</title>
<path stroke-dasharray="5,2" d="M347.6269,-271.8639C332.3955,-266.1282 313.9343,-258.7258 297.8565,-251 293.0524,-248.6915 239.5093,-217.9237 203.8198,-197.3634"/>
<polygon points="205.1391,-194.0841 194.7272,-192.1236 201.6439,-200.1491 205.1391,-194.0841"/>
<text text-anchor="middle" x="275.4072" y="-243.2">2</text>
</g>
<g class="m-node">
<title>p0x7fca00804190</title>
<polygon points="585.6919,-233 504.7339,-215 585.6919,-197 666.65,-215 585.6919,-233"/>
<text text-anchor="middle" x="585.6919" y="-210.2">flip&#45;coin&#45;3</text>
</g>
<g class="m-edge">
<title>p0x7fca00804070&#45;&gt;p0x7fca00804190</title>
<path stroke-dasharray="5,2" d="M411.6125,-272.2252C447.2148,-260.5216 504.2112,-241.7852 543.2204,-228.9617"/>
<polygon points="544.3196,-232.2847 552.7264,-225.8368 542.1335,-225.6348 544.3196,-232.2847"/>
<text text-anchor="middle" x="482.2637" y="-252.2">0</text>
</g>
<g class="m-edge">
<title>p0x7fca00804190&#45;&gt;p0x7fca00803f50</title>
<path stroke-dasharray="5,2" d="M513.3693,-213.0235C455.059,-210.9384 371.0107,-206.8241 297.8565,-199 274.2925,-196.4797 248.4138,-192.5678 226.2812,-188.8698"/>
<polygon points="226.8424,-185.4151 216.3976,-187.1915 225.6705,-192.3163 226.8424,-185.4151"/>
<text text-anchor="middle" x="378.8355" y="-213.2">1</text>
</g>
<g class="m-edge">
<title>p0x7fca00804190&#45;&gt;p0x7fca00803f50</title>
<path stroke-dasharray="5,2" d="M555.1722,-203.678C529.9954,-194.9727 493.129,-183.6702 459.8145,-179 385.9362,-168.6433 300.3396,-170.3656 241.8151,-173.6012"/>
<polygon points="241.354,-170.122 231.5746,-174.198 241.7613,-177.1101 241.354,-170.122"/>
<text text-anchor="middle" x="378.8355" y="-182.2">2</text>
</g>
<g class="m-node">
<title>p0x7fca008042b0</title>
<polygon points="792.5484,-140 711.5904,-122 792.5484,-104 873.5064,-122 792.5484,-140"/>
<text text-anchor="middle" x="792.5484" y="-117.2">flip&#45;coin&#45;4</text>
</g>
<g class="m-edge">
<title>p0x7fca00804190&#45;&gt;p0x7fca008042b0</title>
<path stroke-dasharray="5,2" d="M612.7348,-202.8419C649.4364,-186.3413 715.1315,-156.8056 756.1398,-138.3688"/>
<polygon points="757.8135,-141.4539 765.4989,-134.1611 754.9431,-135.0695 757.8135,-141.4539"/>
<text text-anchor="middle" x="689.1202" y="-171.2">0</text>
</g>
<g class="m-edge">
<title>p0x7fca008042b0&#45;&gt;p0x7fca00803f50</title>
<path stroke-dasharray="5,2" d="M731.8519,-126.5516C634.5164,-134.0048 437.5297,-149.7224 270.958,-167 258.9194,-168.2487 246.073,-169.7105 233.7583,-171.1758"/>
<polygon points="233.0782,-167.7324 223.5684,-172.4029 233.9152,-174.6822 233.0782,-167.7324"/>
<text text-anchor="middle" x="482.2637" y="-150.2">1</text>
</g>
<g class="m-edge">
<title>p0x7fca008042b0&#45;&gt;p0x7fca00803f50</title>
<path stroke-dasharray="5,2" d="M723.848,-119.2642C627.6819,-116.7729 447.8752,-117.0032 297.8565,-145 270.1101,-150.1781 239.5305,-158.3778 215.4596,-165.4274"/>
<polygon points="214.1582,-162.1628 205.5693,-168.3661 216.152,-168.8728 214.1582,-162.1628"/>
<text text-anchor="middle" x="482.2637" y="-126.2">2</text>
</g>
<g class="m-node">
<title>p0x7fca008043d0</title>
<polygon points="999.4049,-70 918.4468,-52 999.4049,-34 1080.3629,-52 999.4049,-70"/>
<text text-anchor="middle" x="999.4049" y="-47.2">flip&#45;coin&#45;5</text>
</g>
<g class="m-edge">
<title>p0x7fca008042b0&#45;&gt;p0x7fca008043d0</title>
<path stroke-dasharray="5,2" d="M824.8697,-111.0625C860.5903,-98.9747 918.2426,-79.4652 957.4295,-66.2044"/>
<polygon points="958.6194,-69.4968 966.9698,-62.976 956.3756,-62.8662 958.6194,-69.4968"/>
<text text-anchor="middle" x="895.9766" y="-90.2">0</text>
</g>
<g class="m-edge">
<title>p0x7fca008043d0&#45;&gt;p0x7fca00803f50</title>
<path stroke-dasharray="5,2" d="M918.3562,-52C880.185,-52 834.0274,-52 792.5484,-52 378.8355,-52 378.8355,-52 378.8355,-52 300.4798,-52 226.8217,-118.9974 192.373,-155.6693"/>
<polygon points="189.4333,-153.6956 185.2446,-163.4273 194.5878,-158.4318 189.4333,-153.6956"/>
<text text-anchor="middle" x="585.6919" y="-55.2">1</text>
</g>
<g class="m-edge">
<title>p0x7fca008043d0&#45;&gt;p0x7fca00803f50</title>
<path stroke-dasharray="5,2" d="M971.1909,-40.2004C931.8869,-24.8582 858.0913,0 792.5484,0 378.8355,0 378.8355,0 378.8355,0 285.8108,0 214.038,-104.7938 185.4561,-154.0174"/>
<polygon points="182.3642,-152.3744 180.4739,-162.7992 188.4526,-155.8285 182.3642,-152.3744"/>
<text text-anchor="middle" x="585.6919" y="-3.2">2</text>
</g>
<g class="m-node m-flat">
<title>p0x7fca008044f0</title>
<ellipse cx="1156.3025" cy="-52" rx="31.0404" ry="18"/>
<text text-anchor="middle" x="1156.3025" y="-47.2">stop</text>
</g>
<g class="m-edge">
<title>p0x7fca008043d0&#45;&gt;p0x7fca008044f0</title>
<path stroke-dasharray="5,2" d="M1080.6112,-52C1092.5002,-52 1104.3046,-52 1114.9304,-52"/>
<polygon points="1115.1229,-55.5001 1125.1229,-52 1115.1228,-48.5001 1115.1229,-55.5001"/>
<text text-anchor="middle" x="1102.8331" y="-55.2">0</text>
</g>
</g>
</svg>
</div><p>Similarly, we can extend the probabilistic condition to any degree.</p></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Taskflow handbook is part of the <a href="https://taskflow.github.io">Taskflow project</a>, copyright © <a href="https://tsung-wei-huang.github.io/">Dr. Tsung-Wei Huang</a>, 2018&ndash;2020.<br />Generated by <a href="https://doxygen.org/">Doxygen</a> 1.8.14 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
